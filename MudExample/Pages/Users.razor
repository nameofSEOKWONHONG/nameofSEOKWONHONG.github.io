@page "/settings/users"
@using MudExample.Components
@using MudExample.Data
@inherits PageComponentBase
@inject Selector Selector
@inject Selector2 Selector2

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudBreadcrumbs Items="@Breadcrumbs"></MudBreadcrumbs>

    <MudPage Class="mud-border-info border-2 border-solid" Column="2" Row="4" Height="1200px">
        <MudSection Column="1" ColSpan="1" Row="1" RowSpan="4">
            <MudDataGrid Items="@UserList" EditMode="DataGridEditMode.Form" @bind-SelectedItem="SelectedUser">
                <Columns>
                    <SelectColumn T="User" />
                    <PropertyColumn Property="m => m.Id"/>
                    <PropertyColumn Property="m => m.Name"/>
                    <PropertyColumn Property="m => m.Email"/>
                    <PropertyColumn Property="m => m.RoleName"/>
                </Columns>
                <PagerContent>
                    <MudDataGridPager T="User" />
                </PagerContent>
            </MudDataGrid>
        </MudSection>
        <MudSection Column="2" ColSpan="1" Row="1" RowSpan="4" Class="pa-4">
            <MudItem>
                <MudPaper Class="pa-4">
                    <MudForm>
                        <MudTextField T="string" Label="Name" Required="true" RequiredError="User name is required!" @bind-Value="SelectedUser.Name"/>
                        <MudTextField T="string" Label="Email" Required="true" RequiredError="User email is required!" @bind-Value="SelectedUser.Email"/>
                        <MudSelect Label="Role" @bind-Value="@SelectedUser.RoleId" @bind-Text="@SelectedUser.RoleName">
                            @foreach (var role in Role.GetRoles())
                            {
                                <MudSelectItem Value="role.Id">@role.RoleName</MudSelectItem>    
                            }
                        </MudSelect>
                        <RestSelectControl Label="Rest Select Control1" Selector="Selector" @bind-SelectedValue="selected1Value"/>
                        <RestSelectControl Label="Rest Select Control2" Selector="Selector2" @bind-SelectedValue="selected2Value"/>
                    </MudForm>                    
                </MudPaper>
            </MudItem>

            <label>SelectControl1 Result : @selected1Value</label>
            <label>SelectControl2 Result : @selected2Value</label>
        </MudSection>
    </MudPage>
</MudContainer>

@code {
    List<User> UserList = new List<User>();
    User SelectedUser = new User();

    string selected1Value;
    string selected2Value;

    protected override void OnInitialized()
    {
        var roles = Role.GetRoles();
        UserList.Add(new User(1, "test1", "test1@test.com", roles[0].Id, roles[0].RoleName));
        UserList.Add(new User(2, "test2", "test2@test.com", roles[1].Id, roles[1].RoleName));
        UserList.Add(new User(3, "test3", "test3@test.com", roles[1].Id, roles[1].RoleName));
        UserList.Add(new User(4, "test4", "test4@test.com", roles[2].Id, roles[2].RoleName));
    }

    public void OnChanged(SelectItem item)
    {
        Console.WriteLine(item.Text + ":" + item.Value);
    }

    public void OnRoleChanged(int v)
    {
        this.SelectedUser.RoleId = Role.GetRoles()[v-1].Id;
        this.SelectedUser.RoleName = Role.GetRoles()[v-1].RoleName;
        StateHasChanged();
    }

}